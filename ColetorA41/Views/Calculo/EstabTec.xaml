<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ColetorA41.Views.Calculo.EstabTec"
             xmlns:models="clr-namespace:ColetorA41.Models"
              Shell.NavBarIsVisible="False"
             Title="EstabTec">
    <Grid RowDefinitions="200,*,60">
        <StackLayout>
        <Grid RowDefinitions="80,200">
                <Rectangle Fill="{StaticResource MenuCabec}"  Stroke="{StaticResource MenuCabec}"/>
                <Ellipse Grid.Row="1" Fill="{StaticResource MenuCabec}" TranslationY="-110">
                    <Ellipse.Shadow>
                    <Shadow Brush="Black"
 Offset="1,1"
 Radius="5"
 Opacity="0.8" />
                    </Ellipse.Shadow>
                </Ellipse>
            </Grid>

        <VerticalStackLayout VerticalOptions="Center" Margin="0,-280,0,0">
                <Image
                Source="usuario.png"
                HeightRequest="80"
                HorizontalOptions="Center" Margin="0,0,0,10">
                    <Image.Shadow>
                        <Shadow Brush="Black"
    Offset="10,10"
    Radius="40"
    Opacity="0.8" />
                    </Image.Shadow>
                </Image>

                <Label 
                    
                Text="Estabelecimento e Técnico"
                    TextColor="White"
                FontAttributes="Bold"
                FontSize="22"
                VerticalOptions="Center" 
                 HorizontalOptions="Center" Margin="0,0,0,0"/>


            

        </VerticalStackLayout>
        </StackLayout>

        
        <VerticalStackLayout Grid.Row="1" Padding="20">

           
            <Label Text="Estabelecimento"/>
            <Picker Title="Selecione um Estabelecimento"
                     FontAttributes="Bold" FontSize="16"
                     ItemsSource="{Binding listaEstab}"  
                     ItemDisplayBinding="{Binding identific}"
                     SelectedItem="{Binding EstabSelecionado}"
                     Margin="0,0,0,40"/>

            <!--
            <Label Text="Técnico"/>
            <Picker Title="Selecione um Técnico"
                     FontAttributes="Bold" FontSize="16"
                     ItemsSource="{Binding listaTecnico}"  
                     ItemDisplayBinding="{Binding identific}"
                     SelectedItem="{Binding TecnicoSelecionado}"/>
--></VerticalStackLayout>
        <Grid Grid.Row="1" Margin="0,100" Padding="20" RowDefinitions="auto,400">
            <Label Text="Técnico" Margin="0,0,0,10"/>

            <CollectionView x:Name="lista"  Grid.Row="1"
                   ItemsSource="{Binding listaTecnico}" 
                   SelectedItem="{Binding TecnicoSelecionado}"
                   SelectionMode="Single"
                   RemainingItemsThreshold="4"
                   ItemsUpdatingScrollMode="KeepItemsInView"
                   RemainingItemsThresholdReachedCommand="{Binding CarregarTecnicosEstabelecimentoCommand}"
                   EmptyView="Técnicos do Estabelecimento"
                   
                   VerticalScrollBarVisibility="Always">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Tecnico">
                            <Border Margin="5,1" Padding="0" StrokeShape="RoundRectangle 10" BackgroundColor="WhiteSmoke">
                                    <Grid Padding="5" Margin="0,0">
                                        <!--Chave-->
                                        <Label Text="{Binding identific}" x:Name="nomeAbrev" />
                                    </Grid>

                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup Name="TecnicoEstab">
                                        <VisualState Name="Selected">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="LightGray" />
                                                <Setter TargetName="nomeAbrev" Property="Label.FontAttributes" Value="Bold"/>
                                                <Setter TargetName="nomeAbrev" Property="Label.FontSize" Value="18"/>
                                        </VisualState.Setters>
                                        </VisualState>
                                        <VisualState Name="Normal">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="WhiteSmoke" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>


        <Grid ColumnDefinitions="*,*,*" Grid.Row="2" BackgroundColor="White">
            <VerticalStackLayout  Grid.Column="0" HorizontalOptions="Center">
                <Image Source="seta_esquerda" WidthRequest="50">
                    <Image.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ChamarMainPageCommand}" />
                    </Image.GestureRecognizers>
                </Image>

            </VerticalStackLayout>

            <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                <ActivityIndicator
                 Grid.Column="0"
                 IsVisible="{Binding IsBusy}"
                 HorizontalOptions="Center"
                 IsRunning="{Binding IsBusy}"
                 VerticalOptions="Center"
                />
            </VerticalStackLayout>
            <VerticalStackLayout  Grid.Column="2" HorizontalOptions="Center">
                <Image Source="seta_direita" WidthRequest="50">
                    <Image.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ChamarDadosNFCommand}" />
                    </Image.GestureRecognizers>
                </Image>
                
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>